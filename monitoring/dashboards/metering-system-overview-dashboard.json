{
  "title": "Metering - System Overview",
  "tags": [
    "metering",
    "overview",
    "system"
  ],
  "timezone": "browser",
  "refresh": "30s",
  "time": {
    "from": "now-1h",
    "to": "now"
  },
  "panels": [
    {
      "id": 1,
      "title": "Events per Second",
      "type": "gauge",
      "targets": [
        {
          "expr": "rate(metering_events_ingested_total{type=\"total\"}[1m])",
          "legendFormat": "Events/sec",
          "refId": "A"
        }
      ],
      "gridPos": {
        "h": 8,
        "w": 6,
        "x": 0,
        "y": 0
      },
      "fieldConfig": {
        "defaults": {
          "unit": "ops",
          "min": 0,
          "max": 20000,
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "value": 0,
                "color": "red"
              },
              {
                "value": 5000,
                "color": "yellow"
              },
              {
                "value": 10000,
                "color": "green"
              }
            ]
          }
        }
      }
    },
    {
      "id": 2,
      "title": "P95 Latency",
      "type": "stat",
      "targets": [
        {
          "expr": "metering_events_processing_latency_seconds{quantile=\"0.95\"}",
          "legendFormat": "P95",
          "refId": "A"
        }
      ],
      "gridPos": {
        "h": 8,
        "w": 6,
        "x": 6,
        "y": 0
      },
      "fieldConfig": {
        "defaults": {
          "unit": "s",
          "decimals": 3,
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "value": 0,
                "color": "green"
              },
              {
                "value": 0.1,
                "color": "yellow"
              },
              {
                "value": 0.2,
                "color": "red"
              }
            ]
          }
        }
      }
    },
    {
      "id": 3,
      "title": "P99 Latency",
      "type": "stat",
      "targets": [
        {
          "expr": "metering_events_processing_latency_seconds{quantile=\"0.99\"}",
          "legendFormat": "P99",
          "refId": "A"
        }
      ],
      "gridPos": {
        "h": 8,
        "w": 6,
        "x": 12,
        "y": 0
      },
      "fieldConfig": {
        "defaults": {
          "unit": "s",
          "decimals": 3,
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "value": 0,
                "color": "green"
              },
              {
                "value": 0.1,
                "color": "yellow"
              },
              {
                "value": 0.2,
                "color": "red"
              }
            ]
          }
        }
      }
    },
    {
      "id": 4,
      "title": "Error Rate %",
      "type": "stat",
      "targets": [
        {
          "expr": "(rate(metering_events_ingestion_errors_total[1m]) / (rate(metering_events_ingested_total{type=\"total\"}[1m]) + vector(0.0001))) * 100",
          "legendFormat": "Error Rate",
          "refId": "A"
        }
      ],
      "gridPos": {
        "h": 8,
        "w": 6,
        "x": 18,
        "y": 0
      },
      "fieldConfig": {
        "defaults": {
          "unit": "percent",
          "min": 0,
          "max": 1,
          "decimals": 3,
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "value": 0,
                "color": "green"
              },
              {
                "value": 0.1,
                "color": "yellow"
              },
              {
                "value": 1,
                "color": "red"
              }
            ]
          }
        }
      }
    },
    {
      "id": 5,
      "title": "Circuit Breaker - Postgres",
      "type": "stat",
      "targets": [
        {
          "expr": "resilience4j_circuitbreaker_state{name=\"postgres\",state=\"closed\"} * 0 + resilience4j_circuitbreaker_state{name=\"postgres\",state=\"open\"} * 1 + resilience4j_circuitbreaker_state{name=\"postgres\",state=\"half_open\"} * 2",
          "legendFormat": "Postgres",
          "refId": "A"
        }
      ],
      "gridPos": {
        "h": 8,
        "w": 6,
        "x": 0,
        "y": 8
      },
      "fieldConfig": {
        "defaults": {
          "unit": "short",
          "decimals": 0,
          "mappings": [
            {
              "type": "value",
              "options": {
                "0": {
                  "text": "CLOSED",
                  "color": "green"
                },
                "1": {
                  "text": "OPEN",
                  "color": "red"
                },
                "2": {
                  "text": "HALF_OPEN",
                  "color": "yellow"
                }
              }
            }
          ],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "value": 0,
                "color": "green"
              },
              {
                "value": 1,
                "color": "red"
              }
            ]
          }
        }
      }
    },
    {
      "id": 6,
      "title": "Circuit Breaker - Redis",
      "type": "stat",
      "targets": [
        {
          "expr": "resilience4j_circuitbreaker_state{name=\"redis\",state=\"closed\"} * 0 + resilience4j_circuitbreaker_state{name=\"redis\",state=\"open\"} * 1 + resilience4j_circuitbreaker_state{name=\"redis\",state=\"half_open\"} * 2",
          "legendFormat": "Redis",
          "refId": "A"
        }
      ],
      "gridPos": {
        "h": 8,
        "w": 6,
        "x": 6,
        "y": 8
      },
      "fieldConfig": {
        "defaults": {
          "unit": "short",
          "decimals": 0,
          "mappings": [
            {
              "type": "value",
              "options": {
                "0": {
                  "text": "CLOSED",
                  "color": "green"
                },
                "1": {
                  "text": "OPEN",
                  "color": "red"
                },
                "2": {
                  "text": "HALF_OPEN",
                  "color": "yellow"
                }
              }
            }
          ],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "value": 0,
                "color": "green"
              },
              {
                "value": 1,
                "color": "red"
              }
            ]
          }
        }
      }
    },
    {
      "id": 7,
      "title": "Memory Usage %",
      "type": "gauge",
      "targets": [
        {
          "expr": "(sum(jvm_memory_used_bytes{area=\"heap\"}) / sum(jvm_memory_max_bytes{area=\"heap\"} > 0)) * 100",
          "legendFormat": "Heap Usage %",
          "refId": "A"
        }
      ],
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 12,
        "y": 8
      },
      "fieldConfig": {
        "defaults": {
          "unit": "percent",
          "min": 0,
          "max": 100,
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "value": 0,
                "color": "green"
              },
              {
                "value": 80,
                "color": "yellow"
              },
              {
                "value": 90,
                "color": "red"
              }
            ]
          }
        }
      }
    },
    {
      "id": 8,
      "title": "Events per Second Trend",
      "type": "timeseries",
      "targets": [
        {
          "expr": "rate(metering_events_ingested_total{type=\"total\"}[1m])",
          "legendFormat": "Events/sec",
          "refId": "A"
        }
      ],
      "gridPos": {
        "h": 8,
        "w": 24,
        "x": 0,
        "y": 16
      },
      "fieldConfig": {
        "defaults": {
          "unit": "ops",
          "decimals": 2
        }
      }
    }
  ],
  "schemaVersion": 27,
  "version": 0
}
